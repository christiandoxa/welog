# Welog

**Welog** is a structured logging library for Go applications, integrating with **ElasticSearch** and powered by [Logrus](https://github.com/sirupsen/logrus).  
It provides detailed request/response logging for popular Go web frameworks such as **Fiber** and **Gin**, and supports both server-side and client-side HTTP logging.

---

## Features

- üì¶ **Plug-and-play** middleware for Fiber and Gin
- üìù **Structured JSON logs** via Logrus
- üîç **Detailed request/response tracing** with latency and metadata
- üîó **ElasticSearch integration** for centralized log storage
- üéØ **Context-aware logging** for handlers
- üîÑ **Client request logging** for outbound HTTP calls

---

## Installation

```bash
go get github.com/christiandoxa/welog
````

---

## Quick Start

```go
package main

import (
    "net/http"
    "time"

    "github.com/christiandoxa/welog"
    "github.com/christiandoxa/welog/pkg/model"
    "github.com/gofiber/fiber/v2"
)

func main() {
    // 1. Configure ElasticSearch connection
    welog.SetConfig(model.Config{
        ElasticIndex:    "my-logs",
        ElasticURL:      "http://localhost:9200",
        ElasticUsername: "elastic",
        ElasticPassword: "changeme",
    })

    // 2. Create Fiber app and attach Welog middleware
    app := fiber.New()
    app.Use(welog.NewFiber(fiber.Config{}))

    // Example route
    app.Get("/", func(c *fiber.Ctx) error {
        return c.JSON(fiber.Map{"message": "hello world"})
    })

    app.Listen(":3000")
}
```

---

## Configuration

Welog uses `model.Config` to store ElasticSearch connection details:

```go
type Config struct {
    ElasticIndex    string
    ElasticURL      string
    ElasticUsername string
    ElasticPassword string
}
```

Set it at application startup using:

```go
welog.SetConfig(model.Config{
    ElasticIndex:    "my-logs",
    ElasticURL:      "http://localhost:9200",
    ElasticUsername: "elastic",
    ElasticPassword: "changeme",
})
```

### Environment Variables Used

| Variable           | Description              |
| ------------------ | ------------------------ |
| `ELASTIC_INDEX`    | ElasticSearch index name |
| `ELASTIC_URL`      | ElasticSearch base URL   |
| `ELASTIC_USERNAME` | ElasticSearch username   |
| `ELASTIC_PASSWORD` | ElasticSearch password   |

---

## Middleware Setup

### Fiber

```go
app := fiber.New()
app.Use(welog.NewFiber(fiber.Config{}))
```

### Gin

```go
router := gin.Default()
router.Use(welog.NewGin())
```

---

## Client Request Logging

Welog supports logging outbound HTTP requests from within your application.

### Fiber Example

```go
import (
    "time"
    "net/http"
    "github.com/christiandoxa/welog/pkg/model"
)

reqModel := model.TargetRequest{
    URL:         "https://example.com/api",
    Method:      "GET",
    ContentType: "application/json",
    Header:      map[string]interface{}{"Authorization": "Bearer token"},
    Body:        []byte(`{"param":"value"}`),
    Timestamp:   time.Now(),
}

resModel := model.TargetResponse{
    Header:  map[string]interface{}{"Content-Type": "application/json"},
    Body:    []byte(`{"status":"ok"}`),
    Status:  http.StatusOK,
    Latency: 200 * time.Millisecond,
}

welog.LogFiberClient(c, reqModel, resModel)
```

### Gin Example

```go
welog.LogGinClient(c, reqModel, resModel)
```

---

## Logging Inside Handlers

Welog stores a contextual `*logrus.Entry` inside the request context.

### Fiber

```go
c.Locals("logger").(*logrus.Entry).Error("Something went wrong")
```

### Gin

```go
c.MustGet("logger").(*logrus.Entry).Error("Something went wrong")
```

---

## Sample Output

Example JSON log entry generated by `logFiber`:

```json
{
  "level": "info",
  "requestAgent": "PostmanRuntime/7.31.1",
  "requestBody": {"foo": "bar"},
  "requestMethod": "POST",
  "requestUrl": "http://localhost/api/v1/resource",
  "requestTimestamp": "2024-09-25T12:34:56.789Z",
  "responseStatus": 200,
  "responseLatency": "150ms",
  "responseTimestamp": "2024-09-25T12:34:56.939Z",
  "target": [
    {
      "targetRequestMethod": "GET",
      "targetRequestURL": "https://example.com/api/data",
      "targetResponseStatus": 200,
      "targetResponseLatency": "200ms"
    }
  ]
}
```

---

## Contributing

Contributions are welcome! Please open an issue or submit a pull request.

---

## License

MIT License ‚Äî see [LICENSE](LICENSE) for details.
